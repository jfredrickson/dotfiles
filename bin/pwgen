#!/bin/bash

# c-basic-offset: 4; tab-width: 4; indent-tabs-mode: t
# vi: set shiftwidth=4 tabstop=4 noexpandtab:
# :indentSize=4:tabSize=4:noTabs=false:

set -o nounset
set -o errexit
set -o pipefail


# shellcheck disable=SC1090
source "$HOME/bin/common.bash"
check_debug_logging

pwgen='/usr/bin/pwgen -N1'

case ${1:-} in
    # http://stackoverflow.com/questions/806906/how-do-i-test-if-a-variable-is-a-number-in-bash
    *[0-9]*)  # it's a number
        TYPE=normal
        PL=$1
        ;;
    *[!0-9]*)  # it's not a number
        TYPE=$1
        PL=${2:-}
        ;;
    *)  # no parameters
        TYPE=normal
        ;;
esac

case $TYPE in
	low)
        [ -z $PL ] && L=15 || L=$PL
		pass=$($pwgen $L 1)
        msg="low security, $L character length"
        ;;
    norm*)
        [ -z $PL ] && L=30 || L=$PL
		pass=$($pwgen -Bcn $L 1)
        msg="quite secure, $L character length"
        ;;
    hi*)
        [ -z $PL ] && L=50 || L=$PL
		pass=$($pwgen -cnys $L 1)
        msg="very secure, $L character length"
        ;;
    xkcd)
        [ -z $PL ] && L=4 || L=$PL
        # http://xkcd.com/936/
		pass=$(shuf -n$L /usr/share/dict/words | tr -d '\n' | tr -d \')
        msg="XKCD secure, $L word length"
        ;;
	*)
		echo 'Not a valid type: '$TYPE
		exit 1
esac

# formerly using xclip - gives trouble when this script is redirected to not stdout
echo -n $pass | xsel --clipboard --input
notify_libnotify low "Password copied to clipboard" "$msg"

echo $pass

