#!/bin/bash

args="$*"
FORMAT="${FORMAT:-bash}"

execute_commands()
{
        echo
        export IFS=";"
        for command in ${args}
	    do
            echo \$ $command
            echo
            eval $command
            echo
        done
}

if [ "$(basename $0)" = "execho" ]
then
        execute_commands
        exit 0
fi

if [ -z "${args}" ]
then
	paste_url=$(/usr/bin/pastebinit -f $FORMAT | tr -d '\n')
else
    output=`execute_commands 2>&1`
    echo -e "$output"
    echo
	paste_url=$(echo "$output" | /usr/bin/pastebinit -f $FORMAT)
fi

sleep 1

link=`bitly $paste_url | tr -d '\n'`
echo $link
echo $link | tr -d '\n' | xclip -in -selection clipboard
notify-send --category=transfer.complete \
            --urgency=low --icon=gtk-info \
            "Command pasted at $link" "$paste_url"

