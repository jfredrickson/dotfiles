#!/bin/bash

checkmon() {
    (echo -n "$DISPLAYS" | grep $1 | grep $2) 1>/dev/null 2>&1
    return $?
}

action=$1
DISPLAYS=`disper -l | sed ':a;N;s/\n/ /g'`

echo -e "\n* Detected displays:\n"
echo "$DISPLAYS"
echo

case $HOSTNAME in
    cyberlab)
        xrandr --output VGA-0 --mode 1680x1050
        xrandr --output VGA-0 --primary
        ;;
    goldorak)
        if [ -z "$action" ]
        then
            checkmon LVDS1 1366x768     ; laptop=$?
            checkmon DP1 2560x1440      ; acdsamsung=$?
            checkmon HDMI1 1680x1050    ; neovo=$?
            checkmon VGA1 VGA1          ; VGA1=$?
            if [ $laptop -eq 0 -a $acdsamsung -eq 0 ]
            then
                action=acd
                echo 'Detected ACD Samsung monitor, setting up dual screen.'
            elif [ $laptop -eq 0 -a $neovo -eq 0 ]
            then
                action=home
                echo 'Detected Home Neovo screen, setting up dual screen.'
            elif [ $laptop -eq 0 -a $VGA1 -eq 0 ]
            then
                action=vga
                echo 'Detected VGA monitor, setting up dual screen.'
            fi
        fi
        xrandr --dpi 96
        case $action in
            ''|lap*)
                xrandr --output LVDS1   --mode 1366x768 --primary --pos 0x0
                xrandr --output LVDS1   --primary
                xrandr --output DP1     --off
                xrandr --output VGA1    --off
                xrandr --output HDMI1   --off
                ;;
            home)
                # as per original xorg.conf from cyberlab
                xrandr --newmode "1680x1050_60.00" 147.14 1680 1784 1968 2256 1050 1051 1054 1087 -hsync +vsync
                xrandr --addmode HDMI1 1680x1050_60.00
                #
                xrandr --output HDMI1   --primary --mode 1680x1050_60.00 --pos 0x0
                xrandr --output LVDS1   --off
                xrandr --output HDMI1   --primary --mode 1680x1050_60.00 --pos 0x0 \
                       --output LVDS1   --mode 1366x768 --noprimary --pos 1680x0
                xrandr --output HDMI1   --primary
                xrandr --output VGA1    --off
                xrandr --output DP1   --off

                i3-msg workspace 10
                i3-msg move workspace to output LVDS1
                i3-msg workspace 1
                ;;
            vga)
                xrandr --output LVDS1   --mode 1366x768 --noprimary --pos 0x0 \
                       --output VGA1    --auto --primary --pos 1366x0
                xrandr --output VGA1    --primary
                xrandr --output DP1     --off
                xrandr --output HDMI1   --off
                ;;
            hdmi)
                xrandr --output LVDS1   --mode 1366x768 --noprimary --pos 0x0 \
                       --output HDMI1   --auto --primary --pos 1366x0
                xrandr --output LVDS1   --primary
                xrandr --output DP1     --off
                xrandr --output VGA1    --off
                ;;
            proj*)
                xrandr --output LVDS1   --auto --primary
                xrandr --output VGA1    --auto --same-as LVDS1
                xrandr --output DP1     --off
                xrandr --output HDMI1   --off
                ;;
            acd)
                xrandr --output DP1     --primary --mode 2560x1440 --pos 0x0
                xrandr --output LVDS1   --off
                xrandr --output DP1     --primary --mode 2560x1440 --pos 0x0 \
                       --output LVDS1   --mode 1366x768 --noprimary --pos 2560x0
                xrandr --output DP1     --primary
                xrandr --output VGA1    --off
                xrandr --output HDMI1   --off

                i3-msg workspace 10
                i3-msg move workspace to output LVDS1
                i3-msg workspace 1
                ;;
            *)
                echo -e "* ERROR: Invalid action $action\n"
                exit 1
                ;;
            esac
    esac

echo -e "\n* Resetting / resizing background.\n"
setbg >/dev/null
echo
vertical-mouse-settings >/dev/null 2>&1

