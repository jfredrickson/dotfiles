#!/bin/bash

checkmon() {
    (echo -n "$DISPLAYS" | grep $1 | grep $2) 1>/dev/null 2>&1
    return $?
}

arrange-screens-multi-disp() {
                i3-msg workspace 22; i3-msg move workspace to output LVDS-0
                i3-msg workspace back_and_forth
}

action=$1
DISPLAYS=`disper -l | sed ':a;N;s/\n/ /g'`

echo -e "\n* Detected displays:\n"
echo "$DISPLAYS"
echo

case $HOSTNAME in
    cyberlab)
        xrandr --output VGA--0 --mode 1680x1050
        xrandr --output VGA--0 --primary
        ;;
    goldorak)
        if [ -z "$action" ]
        then
            checkmon LVDS-0 1366x768     ; laptop=$?
            checkmon DisplayPort-0 2560x1440      ; acdsamsung=$?
            checkmon HDMI-0 1680x1050    ; neovo=$?
            checkmon VGA-0 VGA-0          ; VGA=$?
            if [ $laptop -eq 0 -a $acdsamsung -eq 0 ]
            then
                action=acd
                echo 'Detected ACD Samsung monitor, setting up screen.'
            elif [ $laptop -eq 0 -a $neovo -eq 0 ]
            then
                action=home
                echo 'Detected Home Neovo screen, setting upscreen.'
            elif [ $laptop -eq 0 -a $VGA-0 -eq 0 ]
            then
                action=vga
                echo 'Detected VGA- monitor, setting up dual screen.'
            fi
        fi
        xrandr --dpi 96
        case $action in
            ''|lap*)
                xrandr --output LVDS-0   --mode 1366x768 --primary --pos 0x0
                xrandr --output LVDS-0   --primary
                xrandr --output DisplayPort-0     --off
                xrandr --output VGA-0    --off
                xrandr --output HDMI-0   --off
                ;;
            home)
                xrandr --output HDMI-0   --primary --mode 1680x1050 --pos 0x0
                #xrandr --output LVDS-0   --mode 1366x768 --noprimary --pos 1680x0
                #arrange-screens-multi-disp
                xrandr --output LVDS-0   --off
                ;;
            vga)
                xrandr --output LVDS-0   --mode 1366x768 --noprimary --pos 0x0
                xrandr --output VGA-0    --auto --primary --pos 1366x0
                ;;
            hdmi)
                xrandr --output HDMI-0   --auto --primary --pos 1366x0
                xrandr --output LVDS-0   --mode 1366x768 --noprimary --pos 0x0
                ;;
            proj*)
                xrandr --output LVDS-0   --auto --primary
                xrandr --output VGA-0    --auto --same-as LVDS-0
                ;;
            acd)
                xrandr --output DisplayPort-0   --primary --mode 2560x1440 --pos 0x0
                #xrandr --output LVDS-0          --mode 1366x768 --noprimary --pos 2560x0
                #arrange-screens-multi-disp
                xrandr --output LVDS-0   --off
                ;;
            *)
                echo -e "* ERROR: Invalid action $action\n"
                exit 1
                ;;
            esac
    esac

echo -e "\n* Resetting / resizing background.\n"
setbg >/dev/null
echo
vertical-mouse-settings >/dev/null 2>&1

