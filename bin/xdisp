#!/bin/bash

checkmon() {
    (echo -n "$DISPLAYS" | grep $1 | grep $2) 1>/dev/null 2>&1
    return $?
}

arrange-screens-multi-disp() {
                i3-msg workspace 22; i3-msg move workspace to output LVDS-1
                i3-msg workspace back_and_forth
}

action=$1
DISPLAYS=`disper -l | sed ':a;N;s/\n/ /g'`

echo -e "\n* Detected displays:\n"
echo "$DISPLAYS"
echo

case $HOSTNAME in
    cyberlab)
        xrandr --output VGA-1 --mode 1680x1050
        xrandr --output VGA-1 --primary
        ;;
    goldorak)
        if [ -z "$action" ]
        then
            checkmon LVDS-1 1366x768     ; laptop=$?
            checkmon DP-1 2560x1440      ; acdsamsung=$?
            checkmon HDMI-1 1680x1050    ; neovo=$?
            checkmon DP-1 3840x2160 ; iiyama=$?
            checkmon VGA-1 VGA-0          ; VGA=$?

            if [ $laptop -eq 0 -a $iiyama -eq 0 ]
            then
                action=home
                echo 'Detected Home iiyama screen, setting up screen.'
            elif [ $laptop -eq 0 -a $acdsamsung -eq 0 ]
            then
                action=acd
                echo 'Detected ACD Samsung monitor, setting up screen.'
            elif [ $laptop -eq 0 -a $neovo -eq 0 ]
            then
                action=home
                echo 'Detected Home Neovo screen, setting upscreen.'
            elif [ $laptop -eq 0 -a $VGA -eq 0 ]
            then
                action=vga
                echo 'Detected VGA- monitor, setting up dual screen.'
            fi
        fi
        xrandr --dpi 96
        case $action in
            ''|lap*)
                xrandr --output LVDS-1   --mode 1366x768 --primary --pos 0x0
                xrandr --output LVDS-1   --primary
                xrandr --output DP-1     --off
                xrandr --output VGA-1    --off
                xrandr --output HDMI-1   --off
                ;;
            home)
                xrandr --output DP-1 --primary --mode 2560x1440 --pos 0x0
                #xrandr --output DP-1 --primary --mode 3840x2160  --pos 0x0
                #xrandr --output LVDS-1   --mode 1366x768 --noprimary --pos 2560x0
                #xrandr --output LVDS-1   --mode 1366x768 --noprimary --pos 3840x0
                #xrandr --output DP-1   --primary
                xrandr --output LVDS-1   --off
                #arrange-screens-multi-disp
                ;;
            vga)
                xrandr --output LVDS-1   --mode 1366x768 --primary --pos 0x0
                xrandr --output VGA-1    --auto --noprimary --pos 1366x0
                ;;
            hdmi)
                xrandr --output HDMI-1   --auto --primary --pos 1366x0
                xrandr --output LVDS-1   --mode 1366x768 --noprimary --pos 0x0
                ;;
            proj*)
                xrandr --output LVDS-1   --auto --primary
                xrandr --output VGA-1    --auto --same-as LVDS-1
                ;;
            acd)
                xrandr --output DP-1   --primary --mode 2560x1440 --pos 0x0
                #xrandr --output LVDS-1          --mode 1366x768 --noprimary --pos 2560x0
                #arrange-screens-multi-disp
                xrandr --output LVDS-1   --off
                ;;
            *)
                echo -e "* ERROR: Invalid action $action\n"
                exit 1
                ;;
            esac
    esac

echo -e "\n* Resetting / resizing background.\n"
setbg >/dev/null
echo
vertical-mouse-settings >/dev/null 2>&1

