#!/bin/bash

self=`basename $0`
activated=`pgrep -f gtrayicon.*-mode`
disable=""
if [ "$1" = "stop" ]
then
    disable="yes"
elif [ "$1" = "nolock" ]
then
    icon="/usr/share/notify-osd/icons/hicolor/scalable/status/notification-display-brightness.svg"
else
    icon="/usr/share/notify-osd/icons/Humanity/scalable/status/notification-gpm-monitor.svg"
fi
runtray="gtrayicon --activated --deactivate-icon=${icon} --activate='/bin/true' --deactivate='${self}'"

if [ -z "${activated}" -a -z "${disable}" ]  # currently inactive and no need to disable presentation mode
then # activate presentation mode
    xautolock -disable  #  disable autolock
    if [ ! "$1" = "nolock" ] # some things to do unless nolock mode
    then
            killall -SIGUSR1 dunst  # disable OSD notifications
            xset -dpms # disable dpms
            xset s off # disable scren saver blanking
    fi
    eval ${runtray} &
else  # currently a mode active, and/or make sure to stop it
    xautolock -enable  # re-enable autolock
    killall -SIGUSR2 dunst  # re-enable OSD notifications
    xset +dpms # re-enable dpms
    xset s # re-enable screen saver blanking
    [ "${activated}" ] && kill ${activated}
fi
