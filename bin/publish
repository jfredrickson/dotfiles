#!/bin/sh

file="$1"
publoc=~/Dropbox/Public
pubfile="${publoc}/$(basename "${file}")"

if [ ! -f "${file}" ]
then	echo File  \'${file}\' not found
	exit 1
fi

if [ "`dirname ${file}`" = "/home/serge/Downloads" ]
then    mv "${file}" "${publoc}"
else    cp "${file}" "${publoc}"
fi
dropbox puburl "${pubfile}"| tr -d '\n' | xclip -in -selection clipboard

echo "'${pubfile}' => $(dropbox puburl "${pubfile}")" && (
    while	(dropbox filestatus "${pubfile}" | grep syncing)
    do	sleep 3
    done
    notify-send --category=transfer.complete \
                --urgency=low --icon=gtk-info \
                "Dropbox file $file published" \
                "file uploaded and url copied to clipboard"
    ) || echo "Dropbox error"
