#!/bin/bash

# load some defaults
. etc/defaults

# check parameters
if  [ "$1" = suspend ]
then
    sleep="yes"
    lockscreen="${2:-$default_lockscreen}"
elif [ "$2" = suspend ]
then
    sleep="yes"
    lockscreen="${1:-$default_lockscreen}"
else
    sleep=""
    lockscreen="${1:-$default_lockscreen}"
fi

if [ ! "$lockscreen" = "keep" -a ! "$lockscreen" = "blurred" ]
then
    # update background lockscreen
    setbg lock "$lockscreen"
elif [ "$lockscreen" = "blurred" ]
then
    # take a screenshot and blur it for the lock screen
    scrot --delay 0 "$screenshot_image" \
        --exec "convert "$screenshot_image" -blur 0x3 "$lockscreen_image
fi

# make sure music stops
mediaplayer_cmd stop

# pause notifications
killall -SIGUSR1 dunst # pause
# lock screen with a background picture, then re-enable notifications
(i3lock -i ~/.lockscreen.png --tiling --nofork ; killall -SIGUSR2 dunst) &

# also suspend if told so
if  [ "$sleep" = yes ]
then
    # wait a bit to make sure it's locked
    sleep 1
    # suspend
    sudo /usr/sbin/pm-suspend
fi

