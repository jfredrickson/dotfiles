#!/bin/bash

. ~/etc/defaults

on_exit() {
    # kill remote process
    ssh ${irssi_host} -o PermitLocalCommand=no "pkill -f 'tail.*.irssi/fnotify'"
}
trap on_exit INT TERM KILL EXIT

ssh ${irssi_host} -o PermitLocalCommand=no \
    "on_exit() { true > .irssi/fnotify; }; trap on_exit INT TERM KILL EXIT;
     cat .irssi/fnotify; tail -n 0 -f $HOME/.irssi/fnotify" | \
    while read network channel message
    do
        notify-send -u normal "${network}  ${channel}" "${message}";
    done

