#!/bin/bash

. ~/etc/defaults

# make sure fnotify process gets killed afterwards
on_exit() {
    # kill the control master
    pkill -f .ssh/cm-irssi
}


if [ "$1" = "lock" ]
then
    ssh ${irssi_host} screen -S irssi -X lockscreen
else
    trap on_exit INT TERM KILL EXIT
    (sleep 3; ssh -X ${irssi_host} -t "~/bin/launch-screen irc add run-one fnotify2mqtt") &
    ssh -X ${irssi_host} -t "export LOCKPRG=~/bin/irclock; ~/bin/launch-screen irc irssi"
fi

