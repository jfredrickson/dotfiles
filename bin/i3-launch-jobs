#!/bin/bash

# c-basic-offset: 4; tab-width: 4; indent-tabs-mode: t
# vi: set shiftwidth=4 tabstop=4 noexpandtab:
# :indentSize=4:tabSize=4:noTabs=false:

set -o nounset
set -o errexit
set -o pipefail


# shellcheck disable=SC1090
source "$HOME/bin/common.bash"
check_debug_logging

# list of jobs to execute in screen
## filter comments and empty lines
JOBS=$(cat <<- EOF | sed -e 's/#.*//' -e '/^\s*$/d'
	mqtt-notify.py
	autocutsel -verbose -selection CLIPBOARD
	pulseaudio-dlna-d # 58080/tcp 65353/udp 1900/udp ALLOW IN
	tail --follow --verbose $HOME/logs/scripts/bin_lock.log
	setbg loop linux

	#rerandr3 daemon
	#autocutsel -verbose -selection PRIMARY
	#dbus-monitor interface=org.freedesktop.Notifications
EOF
)

# check if this is a fresh start, whether there's already an i3jobs screen
if (screen -list | grep -q i3jobs)
then
	PAUSE="0"
else
	# wait a bit more after the first job to allow screen to start up
	PAUSE="2"
fi

# launch the jobs
echo "$JOBS" | while read -r line
do
	i3-launch-job $line
	sleep $PAUSE
done

